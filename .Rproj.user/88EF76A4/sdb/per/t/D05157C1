{
    "contents" : "library(rJava)\nlibrary( RJDBC ) \n\n\npostgres <- JDBC( \"org.postgresql.Driver\", \"postgresql-9.3-1101.jdbc3.jar\")\nconnectPostgres=function()\n{\n  con <- dbConnect(postgres, \"jdbc:postgresql://localhost:5432/immo\", user = \"postgres\", password = \"postgres\" )\n  return(con)\n}\n\ndisconnectPostgres=function(con)\n{\n  dbDisconnect(con)\n}\n\n######################\n\n\nwriteImmoLog<-function (fa, region, curDate)\n{\n  channel<-connectPostgres()  #, pwd = \"locknload\"\n  qr<-paste(\"select max(importdate) from immolog where region='\",region, \"' and qtype=\",max(fa$qtype), sep=\"\")\n  mx<-dbGetQuery(channel, qr)\n  disconnectPostgres(channel)\n  \n \n  if (as.POSIXlt(mx$max,tz = \"GMT\")<as.POSIXlt(curDate,tz = \"GMT\")|is.na(mx$max))\n  {\n    #write\n    fr<-fa[,c(\"id\", \"importdate\", \"region\", \"qtype\")]\n    fnd<-fr[!duplicated(fr[,\"id\"]),]\n      \n    startzeit<-Sys.time()\n    \n    #print(str(fnd))\n    \n    channel<-connectPostgres()  #, pwd = \"locknload\"\n    \n    dbWriteTable(channel, name=\"immolog\", value=fnd , append=TRUE, row.names=FALSE, overwrite=FALSE)\n    #dbWriteTable(channel, name=\"immolog\", value=fnd, row.names=FALSE )\n    \n    disconnectPostgres(channel)\n    \n    laufzeit<-Sys.time()-startzeit\n    print(\"ImmoLog Written\")\n    print(laufzeit)\n    \n    \n      \n  }else{\n    print(\"Immolog Skipped\")\n  }\n\n}\n\n\nwriteImmoList=function(fa)\n{\n  \n  \n  fand<-fa[!duplicated(fa[,\"id\"]),]\n  ids<-fand[,c(\"id\",\"importdate\")]\n  \n  channel<-connectPostgres()  \n  dbWriteTable(channel, name=\"newrows\", value=ids)\n  try(dbSendQuery(conn = channel, statement = \"delete from immolist where id in (select id from newrows)\"))\n  \n  #dbWriteTable(channel, name=\"immolist\", value=fand, row.names=FALSE)\n  dbWriteTable(channel, name=\"immolist\", value=fand,append=TRUE, row.names=FALSE, overwrite=FALSE)\n  disconnectPostgres(channel) \n\n\n}\n\n\n\n",
    "created" : 1438349020649.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2952591106",
    "id" : "D05157C1",
    "lastKnownWriteTime" : 1438348674,
    "path" : "E:/Work/immo/dbFunctions.R",
    "project_path" : "dbFunctions.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}