{
    "contents" : "\n\n\nlibrary(XML)\nlibrary(rjson)\nlibrary(dplyr)\n\nsource(\"getImmo.R\")\nsource(\"writeImmo.R\")\n\n# region = \"Rheinland-Pfalz/Koblenz\"\n# region = \"Rheinland-Pfalz/Mainz\"\n# region = \"Berlin/Berlin\"\n# region = \"Hamburg/Hamburg\"\n# region = \"Bremen/Bremen\"\n# region = \"Nordrhein-Westfalen/Koeln\"\n# region = \"Nordrhein-Westfalen/Bonn\"\n# region =\"Nordrhein-Westfalen/Dortmund\"\n# region =\"Nordrhein-Westfalen/Duesseldorf\"\n# region =\"Nordrhein-Westfalen/Leverkusen\"\n# region =\"Nordrhein-Westfalen/Duisburg\"\n# region =\"Nordrhein-Westfalen/Hagen\"\n# region =\"Nordrhein-Westfalen/Siegen-Wittgenstein-Kreis/Siegen\"\n\n\nregionList<-c(\"Rheinland-Pfalz/Koblenz\",\n              \"Rheinland-Pfalz/Mainz\",\n              \"Nordrhein-Westfalen/Duesseldorf\",\n              \"Nordrhein-Westfalen/Koeln\",\n              \"Nordrhein-Westfalen/Bonn\", \n              \"Nordrhein-Westfalen/Leverkusen\",\n              \"Nordrhein-Westfalen/Hagen\",\n              \"Hamburg/Hamburg\",\n              \"Bremen/Bremen\",\n              \"Berlin/Berlin\")\n              \n\n#regionList<-c(\"Nordrhein-Westfalen/Dortmund\")\n\nfor (region in regionList)\n{\nf<-getImmo(region=region,maxPages = 1000)\n\nattributes<-as.data.frame(matrix(unlist(strsplit(f$attributes, \";\")), nrow=dim(f)[1], ncol=3, byrow = T), stringsAsFactors = F)\n\ncolnames(attributes)<-c(\"price\",\"area\", \"rooms\")\n\nfa<-cbind(f,attributes)\n\nfa$importdate<-Sys.Date()\nfa$region<-region\n\nregion_<-gsub(\"/\",\"_\",region)\ndate_<-format(Sys.Date(), \"%Y%m%d\")\n\nrms<-fa$rooms%>%lapply(function(x) if(is.character(x)|is.factor(x)) gsub(\"Zi.\",\"\",x) else x)%>%unlist() ###Zi.\nfa$rooms<-as.numeric(gsub(\",\",\".\",rms))\n\n\nprc<-fa$price%>%lapply(function(x) if(is.character(x)|is.factor(x)) gsub(\" \\u20ac\",\"\",x) else x)%>%unlist() ###€\n\nlind<-which(nchar(prc) %in% c(5))\nbef<-substr(prc[lind],1,1)\naft<-substr(prc[lind],3,5)\nconc<-paste(bef,aft,sep = \"\")\nprcw<-prc\nprcw[lind]<-conc\n\nfa$price<-as.numeric(prcw)\n\n\nare<-fa$area%>%lapply(function(x) if(is.character(x)|is.factor(x)) gsub(\"m\\u00b2\",\"\",x) else x)%>%unlist() ### m²\nfa$area<-as.numeric(are)\n\ntit<-fa$title%>%lapply(function(x) if(is.character(x)|is.factor(x)) gsub(\"\\u0022\",\"\",x) else x)%>%unlist() ### \"\"\"\nfa$title<-tit\n\ncolnames(fa)[9]<-\"attribs\"\n\nstr(fa)\ndir.create(paste(\"../immoData/\",date_, sep=\"\"))\nfilenameCSV<-paste(\"../immoData/\",date_,\"/\",region_, \"_\",date_, \".csv\",sep=\"\")\n\n\nwrite.table(fa,file =  filenameCSV, row.names = F, sep=\";\", fileEncoding=\"UTF-8\", quote = TRUE)\n\nfilenameRda<-paste(\"../immoData/\",date_,\"/\",region_, \"_\",date_, \".Rdata\",sep=\"\")\nsave(\"fa\", file=filenameRda)\n\nwriteImmo(fa)\n}\n\n\nfa[1:10,]\n\nstr(fa)\n",
    "created" : 1408392541835.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3226057532",
    "id" : "BC4F6B57",
    "lastKnownWriteTime" : 1408694941,
    "path" : "D:/Work/immo/immScript.R",
    "project_path" : "immScript.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_source"
}