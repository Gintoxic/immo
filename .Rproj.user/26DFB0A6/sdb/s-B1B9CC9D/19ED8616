{
    "contents" : "\nlibrary(XML)\nlibrary(rjson)\n\n\ngetImmo<-function (type=\"Wohnung-Miete\",region=\"Rheinland-Pfalz/Koblenz\", maxPages=20)\n{\n# \n#   type=\"Wohnung-Miete\"\n#   region=\"Rheinland-Pfalz/Koblenz\"\n#   maxEntries=10\n  \n  \n  before<-\"http://www.immobilienscout24.de/Suche/S-T\"\n  \n  #after<-\"\"\n  #url<-\"http://www.immobilienscout24.de/Suche/S-T/Wohnung-Miete/Rheinland-Pfalz/Koblenz?enteredFrom=one_step_search\"\n  #http://www.immobilienscout24.de/Suche/S-T/P-002/Wohnung-Miete/Rheinland-Pfalz/Koblenz?pagerReporting=true\n  \n  continue<-1\n  counter<-1\n  \n  while (continue==1)\n  {\n  \n   if (counter==1)\n   {\n     pagenum<-paste(\"P-\",formatC(0, width = 3, format = \"d\", flag = \"0\"), sep=\"\") \n   }else{\n     pagenum<-paste(\"P-\",formatC(counter, width = 3, format = \"d\", flag = \"0\"), sep=\"\") \n   }\n     \n  \n   \n  myurl<-paste(before, pagenum,type, region, sep=\"/\")\n  print(myurl)\n\n  \n  doc<-htmlParse(myurl, encoding=\"UTF-8\")\n\n  ch<-as(doc, \"character\")\n  jsonstart<-regexpr(\"model:\",ch)[1]+7\n  jsonend<-regexpr(\"travelTimeModel\",ch)[1]-1\n  \n  chjson<-substr(ch, jsonstart,jsonend)\n  fj<-fromJSON(chjson)\n  \n  \n  attriblist<-c(\"id\",\"cwid\", \"privateOffer\" ,\"title\", \"address\", \"district\",\"city\", \"zip\", \"attributes\")\n  \n  empty<-matrix(nrow=length(fj$results), ncol=length(attriblist))\n  \n  colnames(empty)<-attriblist\n  \n  frame<-as.data.frame(empty)\n  \n\n  for (i in 1:length(fj$results))\n  {\n    \n    cur<-fj$results[[i]]\n    \n    for (j in 1:length(attriblist))\n    {\n      \n      if (attriblist[j]!=\"attributes\")\n      {\n        frame[i,attriblist[j]]<-cur[[attriblist[j]]]\n      }else{\n        frame[i,attriblist[j]]<-paste(cur[[attriblist[j]]], collapse=\";\")\n      }\n      \n      \n    }# for\n    \n  }# for\n  \n  #frame\n  \n    if(counter==1)\n    {\n      frameAll<-frame\n      frameLast<-frame\n    }else{\n        \n      \n      if(identical(frame,frameLast) | counter>maxPages)\n      {\n        continue=0\n        \n      }else{\n      frameAll<-rbind(frameAll, frame)\n      frameLast<-frame\n      }#else\n    }#else\n  counter<-counter+1\n}#while\n  \nreturn(frameAll)\n}#function",
    "created" : 1408392560518.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "320643389",
    "id" : "19ED8616",
    "lastKnownWriteTime" : 1408396724,
    "path" : "D:/Work/immo/getImmo.R",
    "project_path" : "getImmo.R",
    "properties" : {
        "tempName" : "Untitled2"
    },
    "source_on_save" : true,
    "type" : "r_source"
}